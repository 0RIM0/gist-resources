(function(){"use strict";var n=typeof n<"u"?n:{},y={},p;for(p in n)n.hasOwnProperty(p)&&(y[p]=n[p]);var h=n.printErr||console.warn.bind(console);for(p in y)y.hasOwnProperty(p)&&(n[p]=y[p]);var D=(e,t)=>{throw t};y=null,n.arguments&&n.arguments,n.thisProgram&&(thisProgram=n.thisProgram),n.quit&&(D=n.quit),typeof WebAssembly!="object"&&b("no native wasm support detected");var S,R=!1,x,A;function Z(){var e=S.buffer;n.HEAP8=new Int8Array(e),n.HEAPU8=A=new Uint8Array(e)}var C=[],I=[],M=[];function j(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)V(n.preRun.shift());E(C)}function B(){E(I)}function J(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Q(n.postRun.shift());E(M)}function V(e){C.unshift(e)}function K(e){I.unshift(e)}function Q(e){M.unshift(e)}var _=0,g=null;function X(e){var t;_++,(t=n.monitorRunDependencies)===null||t===void 0||t.call(n,_)}function Y(e){var t;if(_--,(t=n.monitorRunDependencies)===null||t===void 0||t.call(n,_),_==0&&g){var r=g;g=null,r()}}function b(e){var t;(t=n.onAbort)===null||t===void 0||t.call(n,e),e="Aborted("+e+")",h(e),R=!0,e+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(e);throw r}function G(){return{a:me}}function q(e){return fetch(e,{credentials:"same-origin"}).then(function(t){if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()})}function ee(e){var t=G();function r(c,u){return f=c.exports,S=f.f,Z(),K(f.g),Y(),f}X();function i(c){r(c.instance)}function o(c){return q(e).then(function(u){var d=WebAssembly.instantiate(u,t);return d}).then(c,function(u){h("failed to asynchronously prepare wasm: "+u),b(u)})}function a(){return e&&e.byteLength>0?WebAssembly.instantiate(e,t).then(i,function(c){h("wasm compile failed: "+c)}):typeof WebAssembly.instantiateStreaming=="function"&&typeof e=="string"&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(function(c){var u=WebAssembly.instantiateStreaming(c,t);return u.then(i,function(d){return h("wasm streaming compile failed: "+d),h("falling back to ArrayBuffer instantiation"),o(i)})}):o(i)}if(n.instantiateWasm)try{var s=n.instantiateWasm(t,r);return s}catch(c){return h("Module.instantiateWasm callback failed with error: "+c),!1}return a(),{}}class z{constructor(t){this.name="ExitStatus",this.message=`Program terminated with exit(${t})`,this.status=t}}var E=e=>{for(;e.length>0;)e.shift()(n)},L=n.noExitRuntime||!0,te=()=>b(""),U=0,ne=()=>{L=!1,U=0},w={},W=e=>{if(e instanceof z||e=="unwind")return x;D(1,e)},P=()=>L||U>0,k=e=>{var t;x=e,P()||((t=n.onExit)===null||t===void 0||t.call(n,e),R=!0),D(e,new z(e))},re=(e,t)=>{x=e,k(e)},ie=re,ae=()=>{if(!P())try{ie(x)}catch(e){W(e)}},se=e=>{if(!R)try{e(),ae()}catch(t){W(t)}},oe=()=>performance.now(),ce=(e,t)=>{if(w[e]&&(clearTimeout(w[e].id),delete w[e]),!t)return 0;var r=setTimeout(()=>{delete w[e],se(()=>$(e,oe()))},t);return w[e]={id:r,timeout_ms:t},0},ue=()=>2147483648,le=(e,t)=>Math.ceil(e/t)*t,fe=e=>{var t=S.buffer,r=(e-t.byteLength+65535)/65536|0;try{return S.grow(r),Z(),1}catch{}},de=e=>{var t=A.length;e>>>=0;var r=ue();if(e>r)return!1;for(var i=1;i<=4;i*=2){var o=t*(1+.2/i);o=Math.min(o,e+100663296);var a=Math.min(r,le(Math.max(e,o),65536)),s=fe(a);if(s)return!0}return!1},me={c:te,b:ne,d:ce,e:de,a:k},f;n._ZSTD_isError=e=>(n._ZSTD_isError=f.h)(e),n._ZSTD_compressBound=e=>(n._ZSTD_compressBound=f.i)(e),n._ZSTD_createCCtx=()=>(n._ZSTD_createCCtx=f.j)(),n._ZSTD_freeCCtx=e=>(n._ZSTD_freeCCtx=f.k)(e),n._ZSTD_compress_usingDict=(e,t,r,i,o,a,s,c)=>(n._ZSTD_compress_usingDict=f.l)(e,t,r,i,o,a,s,c),n._ZSTD_compress=(e,t,r,i,o)=>(n._ZSTD_compress=f.m)(e,t,r,i,o),n._ZSTD_createDCtx=()=>(n._ZSTD_createDCtx=f.n)(),n._ZSTD_freeDCtx=e=>(n._ZSTD_freeDCtx=f.o)(e),n._ZSTD_getFrameContentSize=(e,t)=>(n._ZSTD_getFrameContentSize=f.p)(e,t),n._ZSTD_decompress_usingDict=(e,t,r,i,o,a,s)=>(n._ZSTD_decompress_usingDict=f.q)(e,t,r,i,o,a,s),n._ZSTD_decompress=(e,t,r,i)=>(n._ZSTD_decompress=f.r)(e,t,r,i),n._malloc=e=>(n._malloc=f.s)(e),n._free=e=>(n._free=f.t)(e);var $=(e,t)=>($=f.v)(e,t),T;g=function e(){T||N(),T||(g=e)};function N(){if(_>0||(j(),_>0))return;function e(){var t;T||(T=!0,n.calledRun=!0,!R&&(B(),(t=n.onRuntimeInitialized)===null||t===void 0||t.call(n),J()))}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),e()},1)):e()}if(n.run=N,n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();n.init=ee;var pe=function(e,t,r,i){function o(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function c(l){try{d(i.next(l))}catch(m){s(m)}}function u(l){try{d(i.throw(l))}catch(m){s(m)}}function d(l){l.done?a(l.value):o(l.value).then(c,u)}d((i=i.apply(e,t||[])).next())})};const _e=new Promise(e=>{n.onRuntimeInitialized=e}),he=()=>pe(void 0,void 0,void 0,function*(){yield _e}),ve=e=>{const t=n._ZSTD_isError;return t(e)},ye=(e,t)=>{const r=n._ZSTD_getFrameContentSize;return r(e,t)},ge=(e,t={defaultHeapSize:1024*1024})=>{const r=n._malloc,i=r(e.byteLength);n.HEAP8.set(e,i);const o=ye(i,e.byteLength),a=o===-1?t.defaultHeapSize:o,s=n._free,c=r(a);try{const u=n._ZSTD_decompress,d=u(c,a,i,e.byteLength);if(ve(d))throw new Error(`Failed to compress with code ${d}`);const l=new Uint8Array(n.HEAPU8.buffer,c,d).slice();return s(c,a),s(i,e.byteLength),l}catch(u){throw s(c,a),s(i,e.byteLength),u}};var we=function(e,t,r,i){function o(a){return a instanceof r?a:new r(function(s){s(a)})}return new(r||(r=Promise))(function(a,s){function c(l){try{d(i.next(l))}catch(m){s(m)}}function u(l){try{d(i.throw(l))}catch(m){s(m)}}function d(l){l.done?a(l.value):o(l.value).then(c,u)}d((i=i.apply(e,t||[])).next())})};const Se=e=>we(void 0,void 0,void 0,function*(){const t=new URL(""+new URL("zstd-CV7N7xSg.wasm",self.location.href).href,self.location.href).href;n.init(t),yield he()}),Re=200,xe=100,O=20;let F=null,H=Promise.resolve();const{promise:Te,resolve:De}=Promise.withResolvers();let v=null;const be=async e=>{const t=[];let r=Date.now();const i=v.gists;postMessage({type:"search-start",query:e.raw});for(let o=0;o<i.length;o++){if(o%xe===0){const s=Date.now();if(s-r>Re)if(r=s,await new Promise(u=>setTimeout(u,0)),e==F)t.length&&(postMessage({type:"search",items:t}),t.length=0);else{postMessage({type:"search-cancel"});return}}const a=Ee(e,i[o]);a&&t.push(a)}postMessage({type:"search-done",items:t})},Ee=(e,t)=>{const r=e.match(t[3]);if(!r)return;const i=t[3].slice(Math.max(0,r[0]-O),r[1]+O);return{gist_id:t[0],filename:t[1],created_at:t[2],body:i.split(e.highlighter)}},Ae=e=>e.replace(/[()[\]{}.?*+$^|\\]/g,"\\$1"),Ze=e=>{if(e.trim())if(e.startsWith("/")&&e.endsWith("/")){const t=e.slice(1,-1),r=new RegExp(`(${t})`,"i");return{match:o=>{const a=o.match(r);return a?[a.index,a.index+a[0].length]:null},highlighter:r,raw:e}}else{const t=e.split(/\s+/),r=t.map(s=>s.toLowerCase()),i=s=>{let c=1/0,u=0;const d=s.toLowerCase();for(const l of r){const m=d.indexOf(l);if(m<0)return null;m<c&&(c=m,u=l.length)}return[c,c+u]},o=t.map(Ae).join("|"),a=new RegExp(`(${o})`,"i");return{match:i,highlighter:a,raw:e}}else return},Ce=async e=>{v||await Te;const t=Ze(e);F=t,await H,t?H=be(t):postMessage({type:"clear"})},Ie=async e=>{postMessage({type:"init"});const t=await fetch(e).then(i=>i.arrayBuffer());if(new URL(e).pathname.split(".").at(-1)==="zst"){await Se();const i=new TextDecoder().decode(ge(new Uint8Array(t)));v=JSON.parse(i)}else{const i=new TextDecoder().decode(t);v=JSON.parse(i)}postMessage({type:"ready",length:v.gists.length,timestamp:v.timestamp})};addEventListener("message",async e=>{e.data.load?Ie(e.data.load).then(De,t=>{throw postMessage({type:"error",error:`Failed to load file: ${e.data.load}`}),t}):e.data.query!=null&&Ce(e.data.query)})})();
